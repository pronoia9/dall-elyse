'use client';

import { useEffect, useState } from 'react';

import { useStore } from '@/store';
import { GlobalStyles, StyledComponentsRegistry } from '@/styles';
import { getPosts } from '@/utils';
import '@/styles/photoswipe.css';

// export const metadata = { title: 'DALL-Elyse', description: 'Generated by create next app' };

export default function RootLayout({ children }) {
  const { data, setData } = useStore((state) => ({ data: state.data, setData: state.setData }));
  const [preloading, setPreloading] = useState(true),
    [time, setTime] = useState(0);
  const preloaderTime = 10;

  // FETCHING GALLERY DATA (End the loading screen in 5s if theres local data and we dont have to fetch it)
  useEffect(() => {
    if (getPosts(setData)) setInterval(() => void setTime(preloaderTime), 5000);
  }, []);

  // SET TIMEOUT FOR THE PRELOADER (10s)
  useEffect(() => {
    setTimeout(() => void setTime(preloaderTime), 1000 * preloaderTime);
  }, []);

  // ONCE BOTH DATA IS SET & TIME IS AT LEAST 10s, DISABLE PRELOADER
  useEffect(() => {
    if (data.length && time >= 10) setPreloading(false);
  }, [data, time]);

  return (
    <html lang='en'>
      <head>
        <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css' />
      </head>
      <StyledComponentsRegistry>
        <GlobalStyles />
        <body>{children}</body>
      </StyledComponentsRegistry>
    </html>
  );
}
